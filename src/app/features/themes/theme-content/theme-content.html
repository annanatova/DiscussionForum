<div class="theme-content" *ngIf="theme">

  <!-- Theme title and subscription -->
  <section class="theme-header">
    <div class="theme-name-wrapper">
      <div class="theme-name">
        <ng-container *ngIf="!isEditingTheme; else editForm">
          <h2>{{ theme.themeName }}</h2>
          <p>Date: <time>{{ theme.created_at | date:'medium' }}</time></p>
        </ng-container>

        <ng-template #editForm>
          <input
            type="text"
            [(ngModel)]="editedThemeName"
            placeholder="Edit theme name"
            maxlength="100"
            autofocus
          />
          <button (click)="saveTheme()">Save</button>
          <button (click)="cancelEditTheme()">Cancel</button>
        </ng-template>
      </div>

      <div class="subscribers">
        <p>Subscribers: <span>{{ theme.subscribers.length }}</span></p>

        <ng-container *ngIf="authService.isLoggedIn()">
          <div class="actions-wrapper">
            <button *ngIf="theme.subscribers.includes(currentUserId!); else subscribeBtn" 
                    class="unsubscribe" 
                    (click)="toggleSubscribe()">
              Unsubscribe
            </button>
            <ng-template #subscribeBtn>
              <button class="subscribe" (click)="toggleSubscribe()">Subscribe</button>
            </ng-template>

            <div *ngIf="currentUserId === theme.userId && !isEditingTheme" class="edit-delete-buttons">
              <button (click)="startEditTheme()">Edit Theme</button>
              <button (click)="onDeleteTheme()">Delete Theme</button>
            </div>
          </div>
        </ng-container>
      </div>
    </div>
  </section>

  <!-- Comments list -->
  <section class="comments-list">
    <article class="comment" *ngFor="let comment of comments; trackBy: trackByCommentId">
      <header class="comment-header">
        <p><span>{{ comment.author }}</span> posted on <time>{{ comment.date }}</time></p>
      </header>
      <div class="comment-main">
        <div class="user-details">
          <img src="profile.webp" alt="default user" class="profile-avatar" />
        </div>
        <div class="post-content">
          <p>{{ comment.text }}</p>
        </div>
      </div>
      <footer class="comment-footer">
        <ng-container *ngIf="authService.isLoggedIn()">
          <i class="fas fa-thumbs-up"
             (click)="likeComment(comment.id)"
             [class.liked]="comment.liked"
             style="cursor:pointer"
             title="Like"></i>
          <i class="fas fa-thumbs-down"
             (click)="dislikeComment(comment.id)"
             [class.disliked]="comment.disliked"
             style="cursor:pointer"
             title="Dislike"></i>
        </ng-container>
        <p><span>{{ comment.likes }}</span> likes</p>
      </footer>
    </article>
  </section>

  <!-- Add new comment form -->
  <section class="add-comment" *ngIf="authService.isLoggedIn()">
    <p><span>{{ authService.currentUser()?.username }}</span> comment:</p>
    <form (ngSubmit)="addComment()">
      <textarea
        name="postText"
        id="comment"
        cols="30"
        rows="10"
        [(ngModel)]="newComment"
        placeholder="Write your comment here..."
        [class.input-error]="commentError"
        required
        minlength="10"
        #commentInput="ngModel"
      ></textarea>
      <p class="error" *ngIf="commentError">
        Comment is required and must be at least 10 characters long.
      </p>
      <button type="submit" [disabled]="!isCommentValid()">Post</button>
    </form>
  </section>
</div>